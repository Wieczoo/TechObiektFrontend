{"version":3,"file":"transform.js","names":["Transform","eol","fs","path","VirtualFile","yaml","i18next","sortKeys","dotPathToHash","mergeHashes","transferValues","makeDefaultSort","Parser","i18nTransform","_Transform","_inherits","_super","_createSuper","_this","options","arguments","length","undefined","_classCallCheck","objectMode","call","defaults","contextSeparator","createOldCatalogs","defaultNamespace","defaultValue","indentation","keepRemoved","keySeparator","lexers","lineEnding","locales","namespaceSeparator","pluralSeparator","output","resetDefaultValueLocale","sort","verbose","customValueTemplate","failOnWarnings","yamlOptions","_objectSpread","i18nextOptions","nsSeparator","entries","parserHadWarnings","parserHadUpdate","parser","on","error","warning","warn","localeRegex","namespaceRegex","createInstance","init","_createClass","key","value","emit","console","_transform","file","encoding","done","content","isBuffer","contents","toString","lstatSync","isDirectory","concat","readFileSync","log","filename","basename","parse","_iterator","_createForOfIteratorHelper","_step","s","n","entry","keyPrefix","parts","split","namespace","shift","join","replace","keyWithNamespace","addEntry","err","e","f","_flush","_this2","maybeSortedLocales","a","resetValues","_iterator2","_step2","_loop","locale","catalog","resetAndFlag","uniqueCount","uniquePluralsCount","transformEntry","suffix","_dotPathToHash","separator","duplicate","conflict","_iterator3","_step3","_loop2","count","services","pluralResolver","getSuffixes","ordinal","forEach","outputPath","resolve","namespacePath","parsedNamespacePath","namespaceOldPath","dir","name","ext","existingCatalog","getCatalog","existingOldCatalog","_mergeHashes","fullKeyPrefix","newCatalog","oldKeys","old","mergeCount","oldCount","resetFlags","reset","resetCount","_mergeHashes2","oldCatalog","restoreCount","addCount","failOnUpdate","refCount","maybeSortedNewCatalog","maybeSortedOldCatalog","compare","deep","parserHadSortUpdate","JSON","stringify","pushFile","Object","keys","process","exit","context","contextEntry","assign","push","endsWith","load","code","text","dump","indent","chr","charCodeAt","substr","auto","crlf","cr","lf","Buffer","from","default"],"sources":["../src/transform.js"],"sourcesContent":["import { Transform } from 'stream'\nimport eol from 'eol'\nimport fs from 'fs'\nimport path from 'path'\nimport VirtualFile from 'vinyl'\nimport yaml from 'js-yaml'\nimport i18next from 'i18next'\nimport sortKeys from 'sort-keys'\n\nimport {\n  dotPathToHash,\n  mergeHashes,\n  transferValues,\n  makeDefaultSort,\n} from './helpers.js'\nimport Parser from './parser.js'\n\nexport default class i18nTransform extends Transform {\n  constructor(options = {}) {\n    options.objectMode = true\n    super(options)\n\n    this.defaults = {\n      contextSeparator: '_',\n      createOldCatalogs: true,\n      defaultNamespace: 'translation',\n      defaultValue: '',\n      indentation: 2,\n      keepRemoved: false,\n      keySeparator: '.',\n      lexers: {},\n      lineEnding: 'auto',\n      locales: ['en', 'fr'],\n      namespaceSeparator: ':',\n      pluralSeparator: '_',\n      output: 'locales/$LOCALE/$NAMESPACE.json',\n      resetDefaultValueLocale: null,\n      sort: false,\n      verbose: false,\n      customValueTemplate: null,\n      failOnWarnings: false,\n      yamlOptions: null,\n    }\n\n    this.options = { ...this.defaults, ...options }\n    this.options.i18nextOptions = {\n      ...options.i18nextOptions,\n      pluralSeparator: this.options.pluralSeparator,\n      nsSeparator: this.options.namespaceSeparator,\n    }\n\n    if (this.options.keySeparator === false) {\n      this.options.keySeparator = '__!NO_KEY_SEPARATOR!__'\n    }\n    if (this.options.namespaceSeparator === false) {\n      this.options.namespaceSeparator = '__!NO_NAMESPACE_SEPARATOR!__'\n    }\n    this.entries = []\n\n    this.parserHadWarnings = false\n    this.parserHadUpdate = false\n    this.parser = new Parser(this.options)\n    this.parser.on('error', (error) => this.error(error))\n    this.parser.on('warning', (warning) => this.warn(warning))\n\n    this.localeRegex = /\\$LOCALE/g\n    this.namespaceRegex = /\\$NAMESPACE/g\n\n    this.i18next = i18next.createInstance()\n    this.i18next.init(this.options.i18nextOptions)\n  }\n\n  error(error) {\n    this.emit('error', error)\n    if (this.options.verbose) {\n      console.error('\\x1b[31m%s\\x1b[0m', error)\n    }\n  }\n\n  warn(warning) {\n    this.emit('warning', warning)\n    this.parserHadWarnings = true\n    if (this.options.verbose) {\n      console.warn('\\x1b[33m%s\\x1b[0m', warning)\n    }\n  }\n\n  _transform(file, encoding, done) {\n    let content\n    if (file.isBuffer()) {\n      content = file.contents.toString('utf8')\n    } else if (fs.lstatSync(file.path).isDirectory()) {\n      const warning = `${file.path} is a directory: skipping`\n      this.warn(warning)\n      done()\n      return\n    } else {\n      content = fs.readFileSync(file.path, encoding)\n    }\n\n    this.emit('reading', file)\n    if (this.options.verbose) {\n      console.log(`Parsing ${file.path}`)\n    }\n\n    const filename = path.basename(file.path)\n    const entries = this.parser.parse(content, filename)\n\n    for (const entry of entries) {\n      let key = entry.key\n\n      if (entry.keyPrefix) {\n        key = entry.keyPrefix + this.options.keySeparator + key\n      }\n\n      const parts = key.split(this.options.namespaceSeparator)\n\n      // make sure we're not pulling a 'namespace' out of a default value\n      if (parts.length > 1 && key !== entry.defaultValue) {\n        entry.namespace = parts.shift()\n      }\n      entry.namespace = entry.namespace || this.options.defaultNamespace\n\n      key = parts.join(this.options.namespaceSeparator)\n      key = key.replace(/\\\\('|\"|`)/g, '$1')\n      key = key.replace(/\\\\n/g, '\\n')\n      key = key.replace(/\\\\r/g, '\\r')\n      key = key.replace(/\\\\t/g, '\\t')\n      key = key.replace(/\\\\\\\\/g, '\\\\')\n      entry.key = key\n      entry.keyWithNamespace = entry.namespace + this.options.keySeparator + key\n\n      this.addEntry(entry)\n    }\n\n    done()\n  }\n\n  _flush(done) {\n    let maybeSortedLocales = this.options.locales\n    if (this.options.resetDefaultValueLocale) {\n      // ensure we process the reset locale first\n      maybeSortedLocales.sort((a) =>\n        a === this.options.resetDefaultValueLocale ? -1 : 1\n      )\n    }\n\n    // Tracks keys to reset by namespace\n    let resetValues = {}\n\n    for (const locale of maybeSortedLocales) {\n      const catalog = {}\n      const resetAndFlag = this.options.resetDefaultValueLocale === locale\n\n      let uniqueCount = {}\n      let uniquePluralsCount = {}\n\n      const transformEntry = (entry, suffix) => {\n        if (uniqueCount[entry.namespace] === undefined) {\n          uniqueCount[entry.namespace] = 0\n        }\n        if (uniquePluralsCount[entry.namespace] === undefined) {\n          uniquePluralsCount[entry.namespace] = 0\n        }\n\n        const { duplicate, conflict } = dotPathToHash(entry, catalog, {\n          suffix,\n          locale,\n          separator: this.options.keySeparator,\n          pluralSeparator: this.options.pluralSeparator,\n          value: this.options.defaultValue,\n          customValueTemplate: this.options.customValueTemplate,\n        })\n\n        if (duplicate) {\n          if (conflict === 'key') {\n            this.warn(\n              `Found translation key already mapped to a map or parent of ` +\n                `new key already mapped to a string: ${entry.key}`\n            )\n          } else if (conflict === 'value') {\n            this.warn(`Found same keys with different values: ${entry.key}`)\n          }\n        } else {\n          uniqueCount[entry.namespace] += 1\n          if (suffix) {\n            uniquePluralsCount[entry.namespace] += 1\n          }\n        }\n      }\n\n      // generates plurals according to i18next rules: key_zero, key_one, key_two, key_few, key_many and key_other\n      for (const entry of this.entries) {\n        if (\n          this.options.pluralSeparator !== false &&\n          entry.count !== undefined\n        ) {\n          this.i18next.services.pluralResolver\n            .getSuffixes(locale, { ordinal: entry.ordinal })\n            .forEach((suffix) => {\n              transformEntry(entry, suffix)\n            })\n        } else {\n          transformEntry(entry)\n        }\n      }\n\n      const outputPath = path.resolve(this.options.output)\n\n      for (const namespace in catalog) {\n        let namespacePath = outputPath\n        namespacePath = namespacePath.replace(this.localeRegex, locale)\n        namespacePath = namespacePath.replace(this.namespaceRegex, namespace)\n\n        let parsedNamespacePath = path.parse(namespacePath)\n\n        const namespaceOldPath = path.join(\n          parsedNamespacePath.dir,\n          `${parsedNamespacePath.name}_old${parsedNamespacePath.ext}`\n        )\n\n        let existingCatalog = this.getCatalog(namespacePath)\n        let existingOldCatalog = this.getCatalog(namespaceOldPath)\n\n        // merges existing translations with the new ones\n        const {\n          new: newCatalog,\n          old: oldKeys,\n          mergeCount,\n          oldCount,\n          reset: resetFlags,\n          resetCount,\n        } = mergeHashes(\n          existingCatalog,\n          catalog[namespace],\n          {\n            ...this.options,\n            resetAndFlag,\n            fullKeyPrefix: namespace + this.options.namespaceSeparator,\n          },\n          resetValues[namespace]\n        )\n\n        // record values to be reset\n        // assumes that the 'default' namespace is processed first\n        if (resetAndFlag && !resetValues[namespace]) {\n          resetValues[namespace] = resetFlags\n        }\n\n        // restore old translations\n        const { old: oldCatalog, mergeCount: restoreCount } = mergeHashes(\n          existingOldCatalog,\n          newCatalog,\n          { ...this.options, keepRemoved: false }\n        )\n\n        // backup unused translations\n        transferValues(oldKeys, oldCatalog)\n\n        if (this.options.verbose) {\n          console.log(`[${locale}] ${namespace}`)\n          console.log(\n            `Unique keys: ${uniqueCount[namespace]} (${uniquePluralsCount[namespace]} are plurals)`\n          )\n          const addCount = uniqueCount[namespace] - mergeCount\n          console.log(`Added keys: ${addCount}`)\n          console.log(`Restored keys: ${restoreCount}`)\n          if (this.options.keepRemoved) {\n            console.log(`Unreferenced keys: ${oldCount}`)\n          } else {\n            console.log(`Removed keys: ${oldCount}`)\n          }\n          if (this.options.resetDefaultValueLocale) {\n            console.log(`Reset keys: ${resetCount}`)\n          }\n          console.log('')\n        }\n\n        if (this.options.failOnUpdate) {\n          const addCount = uniqueCount[namespace] - mergeCount\n          const refCount =\n            addCount + restoreCount + (this.options.keepRemoved ? 0 : oldCount)\n          if (refCount !== 0) {\n            this.parserHadUpdate = true\n            continue\n          }\n        }\n\n        if (this.options.failOnWarnings && this.parserHadWarnings) {\n          continue\n        }\n\n        let maybeSortedNewCatalog = newCatalog\n        let maybeSortedOldCatalog = oldCatalog\n        const { sort } = this.options\n        if (sort) {\n          const compare =\n            typeof sort === 'function'\n              ? sort\n              : makeDefaultSort(this.options.pluralSeparator)\n          maybeSortedNewCatalog = sortKeys(newCatalog, {\n            deep: true,\n            compare,\n          })\n\n          maybeSortedOldCatalog = sortKeys(oldCatalog, { deep: true, compare })\n\n          if (this.options.failOnUpdate && !this.parserHadUpdate) {\n            // No updates to the catalog, so we do the deeper check to ensure it is also sorted.\n            // This is easiest to accomplish by simply converting both objects to JSON, as we'd have\n            // to do a deep comparison anyway\n            this.parserHadSortUpdate =\n              JSON.stringify(maybeSortedNewCatalog) !==\n              JSON.stringify(existingCatalog)\n          }\n        }\n\n        // push files back to the stream\n        this.pushFile(namespacePath, maybeSortedNewCatalog)\n        if (\n          this.options.createOldCatalogs &&\n          (Object.keys(oldCatalog).length || existingOldCatalog)\n        ) {\n          this.pushFile(namespaceOldPath, maybeSortedOldCatalog)\n        }\n      }\n    }\n\n    if (this.options.failOnWarnings && this.parserHadWarnings) {\n      this.emit(\n        'error',\n        'Warnings were triggered and failOnWarnings option is enabled. Exiting...'\n      )\n      process.exit(1)\n    }\n\n    if (this.options.failOnUpdate) {\n      if (this.parserHadUpdate) {\n        this.emit(\n          'error',\n          'Some translations was updated and failOnUpdate option is enabled. Exiting...'\n        )\n        process.exit(1)\n      }\n      if (this.parserHadSortUpdate) {\n        this.emit(\n          'error',\n          'Some keys were sorted and failOnUpdate option is enabled. Exiting...'\n        )\n        process.exit(1)\n      }\n    }\n\n    done()\n  }\n\n  addEntry(entry) {\n    if (entry.context) {\n      const contextEntry = Object.assign({}, entry)\n      delete contextEntry.context\n      contextEntry.key += this.options.contextSeparator + entry.context\n      contextEntry.keyWithNamespace +=\n        this.options.contextSeparator + entry.context\n      this.entries.push(contextEntry)\n    } else {\n      this.entries.push(entry)\n    }\n  }\n\n  getCatalog(path) {\n    try {\n      let content\n      if (path.endsWith('yml')) {\n        content = yaml.load(fs.readFileSync(path).toString())\n      } else {\n        content = JSON.parse(fs.readFileSync(path))\n      }\n      return content\n    } catch (error) {\n      if (error.code !== 'ENOENT') {\n        this.emit('error', error)\n      }\n    }\n\n    return null\n  }\n\n  pushFile(path, contents) {\n    let text\n    if (path.endsWith('yml')) {\n      text = yaml.dump(contents, {\n        indent: this.options.indentation,\n        ...this.options.yamlOptions,\n      })\n    } else {\n      text = JSON.stringify(contents, null, this.options.indentation) + '\\n'\n      // Convert non-printable Unicode characters to unicode escape sequence\n      // https://unicode.org/reports/tr18/#General_Category_Property\n      text = text.replace(/[\\p{Z}\\p{Cc}\\p{Cf}]/gu, (chr) => {\n        const n = chr.charCodeAt(0)\n        return n < 128 ? chr : `\\\\u${`0000${n.toString(16)}`.substr(-4)}`\n      })\n    }\n\n    if (this.options.lineEnding === 'auto') {\n      text = eol.auto(text)\n    } else if (\n      this.options.lineEnding === '\\r\\n' ||\n      this.options.lineEnding === 'crlf'\n    ) {\n      text = eol.crlf(text)\n    } else if (\n      this.options.lineEnding === '\\r' ||\n      this.options.lineEnding === 'cr'\n    ) {\n      text = eol.cr(text)\n    } else {\n      // Defaults to LF, aka \\n\n      text = eol.lf(text)\n    }\n\n    const file = new VirtualFile({\n      path,\n      contents: Buffer.from(text),\n    })\n    this.push(file)\n  }\n}\n"],"mappings":"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"}